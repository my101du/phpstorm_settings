<templateSet group="user">
  <template name="t-c-tabs" value="$ctabs-&gt;addTab('All TR', 'tab_browse');&#10;$ctabs-&gt;addTab('My TR', 'tab_my');&#10;$ctabs-&gt;addTab('Details', 'tab_detail');&#10;$ctabs-&gt;addTab('Samples', 'tab_sample');&#10;$ctabs-&gt;setMainDivId('mainTabsDiv');&#10;$ctabs-&gt;setContentDivId('tab_browse_div');" description="make Tabs" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-c-updateForm" value="public function updateDataJsonForm($mockFormData = null)&#10;{&#10;    if (isset($_POST['upd'])) {&#10;        $upd_array      = json_decode($_POST['upd']);&#10;        $additionalData = json_decode($_POST['additionalData']);&#10;        $arraysend      = array($upd_array);&#10;    }&#10;&#10;    $this-&gt;getCdbhelper()-&gt;trans_begin();&#10;&#10;    // shipping (main form data.)&#10;    $error = $this-&gt;mainmodel-&gt;updateGridData($arraysend);&#10;    if ($error != 'OK') {&#10;        $this-&gt;getCdbhelper()-&gt;trans_rollback();&#10;        $msg = '{&quot;status&quot;:' . json_encode($error) . ', &quot;rs&quot;: {} }';&#10;        echo($msg);&#10;        return;&#10;    }&#10;&#10;    // shipping requesters. (Speical field that has multi value: need to json_decode() the passed data.)  &#10;    $error = $this-&gt;requesters_model-&gt;updateGridData(json_decode($upd_array-&gt;ds_requesters_update));&#10;    if ($error != 'OK') {&#10;        $this-&gt;getCdbhelper()-&gt;trans_rollback();&#10;        $msg = '{&quot;status&quot;:' . json_encode($error) . ', &quot;rs&quot;: {} }';&#10;        echo($msg);&#10;        return;&#10;    }&#10;&#10;    // shipping cost (Grid: first bind the grid to form), use:&#10;    // thisObj.Form.addGridToControl('gridShippingCost');&#10;    $error = $this-&gt;cost_model-&gt;updateGridData($additionalData-&gt;gridShippingCost);&#10;    if ($error != 'OK') {&#10;        $this-&gt;getCdbhelper()-&gt;trans_rollback();&#10;        $msg = '{&quot;status&quot;:' . json_encode($error) . ', &quot;rs&quot;: {} }';&#10;        echo($msg);&#10;        return;&#10;    }&#10;&#10;    $this-&gt;getCdbhelper()-&gt;trans_commit();&#10;    $this-&gt;getCdbhelper()-&gt;trans_end();&#10;&#10;    $retResult = $this-&gt;mainmodel-&gt;retRetrieveGridJsonForm($arraysend[0]-&gt;recid);&#10;&#10;    $data = $this-&gt;womodel-&gt;retRetrieveGridJson(&quot;WHERE tr.\&quot;TEST_REQUEST_WORK_ORDER\&quot;.cd_test_request = {$arraysend[0]-&gt;recid}&quot;, &quot;ORDER BY nr_work_order&quot;);&#10;&#10;    $tableinfo = $this-&gt;docrep-&gt;getTableInfo(11, false);&#10;    $aattach = json_encode($this-&gt;docrep-&gt;retSQLArray(&quot; AND cd_test_request = {$arraysend[0]-&gt;recid}&quot;, $orderby = 'ORDER BY dt_record desc', $tableinfo), JSON_NUMERIC_CHECK);&#10;&#10;    // return comments for the &quot;afterupdate&quot;&#10;    $comments = $this-&gt;tr_comments_model-&gt;retRetrieveGridJson(&quot;WHERE cd_test_request = {$arraysend[0]-&gt;recid}&quot;, &quot;ORDER BY 1 DESC&quot;);&#10;&#10;    $msg = '{&quot;status&quot;:' . json_encode($error) . ', &quot;rs&quot;:' . $retResult . ', &quot;wo&quot;: ' . $data . ', &quot;attach&quot;:' . $aattach . ', &quot;comments&quot;:' .&#10;        $comments. '}';&#10;&#10;    echo $msg;&#10;}" description="overwrite  &quot;updateForm&quot;" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Class Member" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-c-updateGrid" value="public function updateDataJson()&#10;{&#10;    $msg = '';&#10;&#10;    $upd_array = json_decode($_POST['upd']);&#10;    $retResultset = 'N';&#10;&#10;    if (isset($_POST['retResultSet'])) {&#10;        $retResultset = $_POST['retResultSet'];&#10;    }&#10;    $jsonMapping = '';&#10;    if (isset($_POST['jsonMapping'])) {&#10;        $jsonMapping = $_POST['jsonMapping'];&#10;    }&#10;&#10;    $this-&gt;cdbhelper-&gt;trans_begin();&#10;&#10;    // main fields update&#10;    $error = $this-&gt;mainmodel-&gt;updateGridData($upd_array);&#10;    if ($error != 'OK') {&#10;        $msg = '{&quot;status&quot;:' . json_encode($error) . ', &quot;rs&quot;:{}}';&#10;        $this-&gt;cdbhelper-&gt;trans_end();&#10;        echo $msg;&#10;        return;&#10;    }&#10;&#10;    // sourcing, multi users. delete &amp; add again.&#10;    foreach($upd_array as $key =&gt; $value) {&#10;        // if changed, remove the old data.&#10;        if($value-&gt;json_human_resource_sourcing) {&#10;&#10;            $delData = json_decode(json_encode($value-&gt;json_human_resource_sourcing),true);&#10;&#10;            $error = $this-&gt;supplier_buyer_model-&gt;deleteGridData($delData);&#10;            if ($error != 'OK') {&#10;                $this-&gt;getCdbhelper()-&gt;trans_rollback();&#10;                $msg = '{&quot;status&quot;:' . json_encode($error) . ', &quot;rs&quot;:{} }';&#10;                echo($msg);&#10;                return;&#10;            }&#10;        }&#10;&#10;        // insert new records.&#10;        if($value-&gt;cds_human_resource_sourcing) {&#10;            $uids    = explode(',', $value-&gt;cds_human_resource_sourcing);&#10;            $i           = -3; // recid &lt; -2 means &quot;new&quot;&#10;            $insData = [];&#10;&#10;            foreach ($uids as $uid) {&#10;                $insData[] = array(&#10;                    'recid' =&gt; $i,&#10;                    'cd_supplier' =&gt; $value-&gt;recid,&#10;                    'cd_human_resource' =&gt; $uid&#10;                );&#10;                $i--;&#10;            }&#10;            $error = $this-&gt;supplier_buyer_model-&gt;updateGridData($insData);&#10;        }&#10;    }&#10;&#10;    $this-&gt;cdbhelper-&gt;trans_commit();&#10;    $this-&gt;cdbhelper-&gt;trans_end();&#10;&#10;    $msg = '{&quot;status&quot;:' . json_encode($error);&#10;&#10;&#10;    $retResult = '{}';&#10;&#10;    if ($retResultset == 'Y' &amp;&amp; $error == 'OK') {&#10;        $neg = $this-&gt;mainmodel-&gt;getNewRecIdsNegative();&#10;        $x = implode(',', $neg);&#10;&#10;        $where = ' where ' . $this-&gt;mainmodel-&gt;pk_field . ' in (';&#10;        foreach ($upd_array as $value) {&#10;            $where = $where . $value-&gt;recid . ',';&#10;        }&#10;        if ($x != '') {&#10;            $where = $where . $x . ', ';&#10;        }&#10;        $where = $where . '-1 )';&#10;&#10;&#10;        $retResult = $this-&gt;mainmodel-&gt;retRetrieveGridJson($where, '', $jsonMapping);&#10;&#10;        $msg = $msg . ', &quot;rs&quot;: ' . $retResult;&#10;&#10;        if (count($neg) &gt; 0) {&#10;            $msg = $msg . ', &quot;negRS&quot;: ' . json_encode($neg);&#10;        }&#10;    }&#10;&#10;    $msg = $msg . '}';&#10;&#10;    //&#10;&#10;    echo $msg;&#10;}" description="overwrite &quot;updateGrid&quot;" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Class Member" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-c-grid" value="$this-&gt;setGridParser();&#10;$grid-&gt;resetGrid();&#10;$grid-&gt;setForceDestroy(true);&#10;$grid-&gt;setSingleBarControl(true);&#10;$grid-&gt;addBreakToolbar();&#10;// $grid-&gt;addInsToolbar();&#10;// $grid-&gt;addDelToolbar();&#10;// $grid-&gt;addEditToolbar();&#10;// $grid-&gt;setInsertNegative(true);&#10;// $grid-&gt;showLineNumbers(!$perm_edit);&#10;$grid-&gt;setToolbarSearch(true);&#10;$grid-&gt;setDemandedColumns(array('cd_test_type'));&#10;$grid-&gt;setCRUDController(&quot;tr/test_request&quot;, false);&#10;$grid-&gt;addCRUDToolbar(true, false, false, false, true); //ret ins upd del hide&#10;&#10;$grid-&gt;addUserBtnToolbar('duplicate', 'Duplicate Selected TR', 'fa fa-files-o');&#10;&#10;$grid-&gt;addSpacerToolbar();&#10;$grid-&gt;addExportToolbar();&#10;&#10;$grid-&gt;addColumnKey();&#10;// add column 1&#10;// add column 2&#10;// ...&#10;&#10;$grid-&gt;setGridName(&quot;gridMyTR&quot;);&#10;$grid-&gt;setGridDivName('browse_grid_div');&#10;$grid-&gt;setGridToolbarFunction(&quot;dsMyTRObject.ToolBarClick&quot;);&#10;&#10;$data = $this-&gt;womodel-&gt;retRetrieveGridJson(&quot;WHERE tr.\&quot;TEST_REQUEST_WORK_ORDER\&quot;.cd_test_request = $code&quot;, &quot;ORDER BY nr_work_order&quot;);&#10;$grid-&gt;addRecords($data);&#10;&#10;$gridBrowse = $grid-&gt;retGrid();" description="make Grid" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-c-grid-attach" value="$grid-&gt;resetGrid();&#10;$tableinfo = $this-&gt;docrep-&gt;getTableInfo(11, true);&#10;$aattach = $this-&gt;docrep-&gt;retSQLArray(&quot; AND cd_test_request = $code&quot;, $orderby = 'ORDER BY dt_record desc', $tableinfo);&#10;&#10;$grid-&gt;addRecords(json_encode($aattach, JSON_NUMERIC_CHECK));&#10;$grid-&gt;setGridToolbarFunction(&quot;dsFormObject.ToolbarTRAttach&quot;);&#10;$grid-&gt;setGridName('gridAttachTR');&#10;$grid-&gt;setGridDivName('AttachTRDiv');&#10;$gridAttach = $grid-&gt;retGrid();" description="make Grid (attachment)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-c-grid-comment" value="$grid-&gt;resetGrid();&#10;$grid-&gt;setSingleBarControl(true);&#10;$grid-&gt;addCRUDToolbar(false, true, false, true, false);&#10;$grid-&gt;setToolbarSearch(false);&#10;$grid-&gt;setCRUDController(&quot;tr/test_request_comments&quot;);&#10;$grid-&gt;addToolbarTitle('Comments');&#10;&#10;$grid-&gt;addColumn('ds_comments', 'Comments', '350px', $f-&gt;retTypeTextPL(), array('limit' =&gt; '500'));&#10;$grid-&gt;addColumn('ds_human_resource', 'User', '100px', $f-&gt;retTypeStringAny(), array('limit' =&gt; '', 'readonly'=&gt;true));&#10;//        $grid-&gt;addColumn('ds_project_comments_type', 'Type', '200px', $f-&gt;retTypePickList(), array('model' =&gt; 'tti/project_comments_type_model', 'codeField' =&gt; 'cd_project_comments_type','readonly'=&gt;true));&#10;$grid-&gt;addColumn('ds_project_comments_type', 'Type', '200px', $f-&gt;retTypeStringAny(), array('limit' =&gt; '', 'readonly'=&gt;true));&#10;$grid-&gt;addColumn('dt_record', 'Date', '100px', $f-&gt;retTypeDate(), false);&#10;&#10;$grid-&gt;setColumnRenderFunc(&quot;ds_comments&quot;, 'dsFormObject.renderDisableCommentsPL');&#10;&#10;$commentsData = $this-&gt;tr_comments_model-&gt;retRetrieveGridJson(&quot;WHERE cd_test_request = $code&quot;, &quot;ORDER BY 1 DESC&quot;);&#10;&#10;$grid-&gt;addRecords($commentsData);&#10;$grid-&gt;setGridToolbarFunction(&quot;dsFormObject.toolbarTRComment&quot;);&#10;$grid-&gt;setGridName('gridTRComment');&#10;$grid-&gt;setGridDivName('divTRComment');&#10;$gridTRComment = $grid-&gt;retGrid();" description="make Grid (comments)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-c-grid-step" value="$grid-&gt;resetGrid();&#10;$grid-&gt;setForceDestroy(true);&#10;$grid-&gt;setSingleBarControl(true);&#10;$grid-&gt;addCRUDToolbar();&#10;$grid-&gt;setToolbarSearch(true);&#10;$grid-&gt;setCRUDController(&quot;tr/test_request_steps&quot;);&#10;$grid-&gt;setGridVar('vStepsGrid');&#10;$grid-&gt;setGridName('stepsGrid');&#10;&#10;$grid-&gt;addColumnKey();&#10;$grid-&gt;addRecords(json_encode($steps, JSON_NUMERIC_CHECK));&#10;$gridSteps = $grid-&gt;retGridVar();" description="make Grid (approval steps)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-c-toolbar" value="$grid-&gt;addCRUDToolbar(false, false, true, false, false);&#10;$grid-&gt;addBreakToolbar();&#10;&#10;$xData = $this-&gt;typemodel-&gt;retRetrieveArray(&quot; WHERE dt_deactivated IS NULL&quot;);&#10;foreach ($xData as $key =&gt; $value ) {&#10;    $grid-&gt;addUserBtnToolbar($value['recid'] , $value['ds_test_type'], '', $value['ds_test_type'], $idToolbar);&#10;}&#10;&#10;// normal toolbar button&#10;$grid-&gt;addUserBtnToolbar('duplicate', 'Duplicate', 'fa fa-copy');&#10;// radio toolbar button&#10;$grid-&gt;addUseRadioToolbar('groupwo', 'Group by Work Order', 'Group by Work Order', true, 1);&#10;&#10;$grid-&gt;setGridVar('vGridToToolbar');&#10;$grid-&gt;setForceDestroy(false);&#10;&#10;$toolbar = $grid-&gt;retGridVar();" description="make Toolbar (button &amp; button group)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-sbsmodal" value="$sbs = '';" description="make a Side-By-Side layout" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-m-retArray" value="$userInfo = $this-&gt;humanmodel-&gt;retRetrieveArray(&quot; WHERE cd_human_resource={$this-&gt;session-&gt;userdata('cd_human_resource')} and cd_location_default IS NOT NULL&quot;);&#10;" description="Model - return Array format" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-m-retEmpty" value="$line = $this-&gt;mainmodel-&gt;retRetrieveEmptyNewArray();&#10;&#10;$recid = $line[0]['recid'];&#10;$line[0]['cd_human_resource_request'] = $this-&gt;session-&gt;userdata('cd_human_resource');" description="Model - return Empty Array" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-m-retJson" value="$records = $this-&gt;mainmodel-&gt;retRetrieveGridJson(&#10;    &quot;WHERE cd_human_resource_request={$uid} OR cd_human_resource_te={$uid}&quot;.&#10;            &quot; OR (EXISTS(select  1 from tr.\&quot;TEST_REQUEST_APPROVAL_STEPS\&quot;  x where x.cd_human_resource_define={$uid} and x&#10;        .cd_test_request = tr.\&quot;TEST_REQUEST\&quot;.cd_test_request)) &quot;.&quot;&#10;        or (EXISTS ( select 1 from tr.\&quot;TEST_REQUEST_WORK_ORDER\&quot; y where y.cd_test_request = tr.\&quot;TEST_REQUEST\&quot;.cd_test_request and y.cd_technician = {$uid}))&quot;, &#10;    &quot; ORDER BY nr_tr_number DESC&quot;&#10;);" description="Model - return json result" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-filter-str" value="$fm-&gt;addSimpleFilterUpper('Test Description', 'filter_20', '&quot;TEST_REQUEST&quot;.ds_test_description');&#10;" description="Filter - String" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-filter-pl" value="$fm-&gt;addPickListFilter('Build', 'filter_', '$folder/$controller', '&quot;$table&quot;.cd_');$END$&#10;" description="Filter - Pick List (from controller/model)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-filter-rel" value="$fm-&gt;addPickListFilter('Build', 'filter_', '$folder/$controller', '&quot;$table&quot;.cd_');$END$&#10;" description="Filter - Related Pick Lists" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-filter-fix" value="foreach($userInfo as $key =&gt; $value) {&#10;    array_push($arrayLoc, array('recid' =&gt; $value['cd_location_default'], 'description' =&gt;$value['ds_location_default'] ));&#10;}&#10;$fm-&gt;addFilter('filter_location', 'Location', array(&#10;    'controller' =&gt; 'location', &#10;    'fieldname' =&gt; '&quot;TEST_REQUEST&quot;.cd_location', &#10;    'multi' =&gt; false,&#10;    'selectedData' =&gt; $arrayLoc)&#10;);" description="Filter - fixed options" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-filter-like" value="$fm-&gt;addFilter('filter_811', 'Project#', array('fieldname' =&gt; &quot;COALESCE(\&quot;TEST_REQUEST\&quot;.ds_met_project, '') || '-' || COALESCE(\&quot;TEST_REQUEST\&quot;.ds_tti_project, '') || '-'&quot;, 'likeIlike' =&gt; 'I', 'startWith' =&gt; false));" description="Filter - complex &quot;like&quot;" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-str" value="$grid-&gt;addColumn('nr_tr_number', 'TR#', '100px', $f-&gt;retTypeStringAny(), false);  // array('limit' =&gt; '40', 'readonly'=&gt;true)&#10;" description="Grid column - String" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-text" value="$grid-&gt;addColumn('ds_wi_description', 'WI Description', '100px', $f-&gt;retTypeTextPL(), array('limit' =&gt; ''));&#10;" description="Grid column - Long text" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-int" value="$grid-&gt;addColumn('nr_power_pack_quantity', 'Power Pack', '80px', $f-&gt;retTypeInteger(), false);&#10;" description="Grid column - Integer" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-num" value="$grid-&gt;addColumn('nr_goal', 'Goal', '80px', $f-&gt;retTypeNum(), array('precision' =&gt; '2', 'readonly' =&gt; false));&#10;" description="Grid column - Float /Numeric" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-date" value="$grid-&gt;addColumn('dt_request', 'Request Date', '80px', $f-&gt;retTypeDate(), false);&#10;" description="Grid column - Date" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-checkbox" value="$grid-&gt;addColumn('fl_return_sample', 'Return Sample', '100px', $f-&gt;retTypeCheckBox(), false);&#10;" description="Grid column - Checkbox" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-pl" value="$grid-&gt;addColumn('ds_location', 'Location', '100px', $f-&gt;retTypePickList(), array('model' =&gt; 'location_model', 'codeField' =&gt; 'cd_location'), true);&#10;" description="Grid column - PickList (with model)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-col-func" value="$grid-&gt;setColumnRenderFunc('ds_test_request_status', 'dsMainObject.setRenderStatus');&#10;" description="Grid column - bind a render function" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-form-pk" value="&lt;input type=&quot;hidden&quot; &#10;    class=&quot;form-control input-sm&quot; &#10;    fieldname=&quot;cd_shipping&quot;&#10;    id=&quot;cd_shipping_form&quot; &#10;    mask=&quot;PK&quot; &#10;    value=&quot;&lt;?php hecho($cd_shipping); ?&gt;&quot; /&gt;" description="Form - Primary Key" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-form-date" value="&lt;label for=&quot;dt_request_form&quot;&#10;   class=&quot;col-sm-1 control-label &quot;&gt;&lt;?php echo($formTrans_dt_request) ?&gt;:&lt;/label&gt;&#10;&lt;div class=&quot;col-sm-2&quot;&gt;&#10;    &lt;input type=&quot;text&quot;&#10;       class=&quot;form-control input-sm&quot;&#10;       fieldname=&quot;dt_request&quot;&#10;       sc=&quot;Y&quot;&#10;       mask=&quot;D;+0D;;&quot;&#10;       ro=&quot;Y&quot;&#10;       value=&quot;&lt;?php hecho($dt_request); ?&gt;&quot;&#10;       id=&quot;dt_request_form&quot;&gt;&#10;&lt;/div&gt;" description="Form - Date" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-form-pld" value="&lt;label for=&quot;ds_$END$_form&quot;&#10;       class=&quot;col-sm-1 control-label &quot;&gt;&lt;?php echo($formTrans_ds_$END$) ?&gt;:&lt;/label&gt;&#10;&lt;div class=&quot;col-sm-2&quot;&gt;&#10;    &lt;input type=&quot;text&quot;&#10;           class=&quot;form-control input-sm&quot;&#10;           plcode=&quot;-10&quot;&#10;           value=&quot;&lt;?php hecho($ds_$END$) ?&gt;&quot;&#10;           fieldname=&quot;ds_NAME&quot;&#10;           id=&quot;ds_$END$_form&quot;&#10;           mask=&quot;PLD&quot;&#10;           model=&quot;&lt;?php echo($this-&gt;encodeModel('MODEL/NAME')); ?&gt;&quot;&#10;           fieldname=&quot;ds_$END$&quot;&#10;           code_field=&quot;cd_$END$&quot;&#10;           relid=&quot;-1&quot;&#10;           relCode=&quot;-1&quot;&#10;           min=&quot;2&quot;&#10;           type=&quot;text&quot;&gt;&#10;&lt;/div&gt;" description="Form - PLD picklist dropdown" toReformat="false" toShortenFQNames="true">
    <variable name="formTrans_ds_" expression="" defaultValue="" alwaysStopAt="true" />
    <variable name="ds_" expression="" defaultValue="" alwaysStopAt="true" />
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-form-rel" value="&lt;?php&#10;// Team must = &quot;Test Engineers&quot; (Team Group)&#10;$sqlOnlyTE = $this-&gt;cdbhelper-&gt;getFilterQueryId(' AND cd_test_team_groups= ' . $this-&gt;cdbhelper-&gt;getSystemParameters('TEST_TEAM_GROUPS_TEST_ENGINEER'));&#10;&#10;// test engineer in Team.&#10;$sqlInTeam = $this-&gt;cdbhelper-&gt;getFilterQueryId(' AND EXISTS (SELECT 1 FROM &quot;TEST_TEAM_X_HUMAN_RESOURCE&quot; x '&#10;    .'WHERE x.cd_human_resource = &quot;HUMAN_RESOURCE&quot;.cd_human_resource '&#10;    .'AND x.cd_test_team = %s AND x.dt_deactivated IS NULL) ');&#10;?&gt;&#10;&#10;&lt;label for=&quot;ds_test_team_form&quot;&#10;       class=&quot;col-sm-1 control-label after-submit-step&quot;&gt;&lt;?php echo($formTrans_ds_test_team)&#10;    ?&gt;:&lt;/label&gt;&#10;&lt;div class=&quot;col-sm-2 after-submit-step&quot;&gt;&#10;    &lt;input type=&quot;text&quot;&#10;           class=&quot;form-control input-sm&quot;&#10;           plcode=&quot;&lt;?php echo($cd_test_team) ?&gt;&quot;&#10;           value=&quot;&lt;?php hecho($ds_test_team) ?&gt;&quot;&#10;           fieldname=&quot;ds_test_team&quot;&#10;           id=&quot;ds_test_team_form&quot;&#10;           mask=&quot;PLD&quot;&#10;           model=&quot;&lt;?php echo($this-&gt;encodeModel('tr/test_team_model')); ?&gt;&quot;&#10;           code_field=&quot;cd_test_team&quot;&#10;           relid=&quot;&lt;?php echo($sqlOnlyTE) ?&gt;&quot;&#10;           ro=&quot;&lt;?php echo($perm_edit == true ? 'N' : 'Y') ?&gt;&quot;&#10;           relCode=&quot;-1&quot;&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;label for=&quot;ds_human_resource_te_form&quot;&#10;       class=&quot;col-sm-1 control-label after-submit-step&quot;&gt;&lt;?php echo($formTrans_cd_human_resource_te) ?&gt;:&lt;/label&gt;&#10;&lt;div class=&quot;col-sm-2 after-submit-step&quot;&gt;&#10;    &lt;input type=&quot;text&quot;&#10;           class=&quot;form-control input-sm&quot;&#10;           plcode=&quot;&lt;?php echo($cd_human_resource_te) ?&gt;&quot;&#10;           value=&quot;&lt;?php hecho($ds_human_resource_te) ?&gt;&quot;&#10;           fieldname=&quot;ds_human_resource_te&quot;&#10;           id=&quot;ds_human_resource_te_form&quot;&#10;           mask=&quot;PLD&quot;&#10;           model=&quot;&lt;?php echo($this-&gt;encodeModel('human_resource_model')); ?&gt;&quot;&#10;           fieldname=&quot;ds_human_resource_te&quot;&#10;           code_field=&quot;cd_human_resource_te&quot;&#10;           relid=&quot;&lt;?php echo($sqlInTeam) ?&gt;&quot;&#10;           ro=&quot;&lt;?php echo($perm_edit == true ? 'N' : 'Y') ?&gt;&quot;&#10;           relCode=&quot;-1&quot;&gt;&#10;&lt;/div&gt;" description="Form - related picklist dropdown" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-form-rel" value="$('#formTRRequest').on('pospicklist', function (ev) {&#10;    // TEST TEAM&#10;    if (ev.fielddata.codefield == 'cd_test_team') {&#10;        // set the &quot;supervisor&quot; in test team, as the responsible_te (the model return supervisor column.)&#10;        // thisObj.Form.setItemPL('ds_human_resource_te_form', -1, '');&#10;        var supervisor = JSON.parse(ev.record.dss_supervisor);&#10;        thisObj.Form.setItemPL(&#10;            'ds_human_resource_te_form',&#10;            supervisor.length &gt; 0 ? supervisor[0].cd_human_resource : -1,&#10;            supervisor.length &gt; 0 ? supervisor[0].ds_human_resource : ''&#10;        );&#10;    }&#10;});&#10;&#10;$('#formTRRequest').on('prepicklist', function (ev) {&#10;    // test engineer must in the selected team&#10;    if (ev.fielddata.codefield == 'cd_human_resource_te') {&#10;        var vcode = chkUndefined(thisObj.Form.getItemPLCode('ds_test_team_form'), -1);&#10;        thisObj.Form.setPLRelCode('ds_human_resource_te_form', vcode);&#10;        ev.options.relation.id = vcode;&#10;    }&#10;});" description="Javascript - Form - set related picklists" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-form-multi" value="&lt;label for=&quot;ds_requesters_form&quot; class=&quot;col-sm-1 control-label&quot;&gt;&lt;?php echo($formTrans_ds_requesters) ?&gt;:&lt;/label&gt;&#10;&lt;div class=&quot;col-sm-4&quot;&gt;&#10;    &lt;input type=&quot;text&quot; &#10;        class=&quot;form-control input-sm&quot; &#10;        fieldname=&quot;ds_requesters&quot;&#10;        id=&quot;ds_requesters_form&quot; &#10;        mask=&quot;XXX&quot;&#10;        must=&quot;Y&quot;&#10;        model = &quot;&lt;?php echo ($this-&gt;encodeModel('human_resource_model')); ?&gt;&quot; &#10;        code_field=&quot;cd_human_resource&quot;&#10;        relid=&quot;-1&quot; &#10;        relCode=&quot;-1&quot;&#10;        multiple=&quot;Y&quot;&gt;&#10;    &lt;input type=&quot;hidden&quot; &#10;        class=&quot;form-control input-sm&quot; &#10;        fieldname=&quot;ds_requesters_update&quot;&#10;        id=&quot;ds_requesters_update_form&quot; &#10;        mask=&quot;t&quot;  /&gt;&#10;&lt;/div&gt;" description="Form - multi choose" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-setForm" value="thisObj.Form = $('#formTRRequest').cgbForm({updController: 'tr/test_request'});&#10;thisObj.Form.addGridToControl('gridWO');&#10;thisObj.Form.addGridToControl('gridRelatedModels');&#10;thisObj.Form.addGridToControl('gridAttachTR');&#10;thisObj.Form.addGridToControl('gridTRComment');&#10;thisObj.Form.addGridToControl('stepsGrid');&#10;&#10;var vtoolbar = vGridToToolbar.toolbar;&#10;&#10;vtoolbar.onClick = function (a, b) {&#10;    if (a == 'update') {&#10;        thisObj.updateData();&#10;    }&#10;};&#10;vtoolbar.name = 'TRFormToolbar';&#10;&#10;if (w2ui['TRFormToolbar'] != undefined) {&#10;    w2ui['TRFormToolbar'].destroy();&#10;}&#10;&#10;w2ui['gridRelatedModels'].editOnInsert = false;&#10;var vCodeShow = '&lt;?php if ($nr_tr_number != 0) {&#10;    $codehist = &quot;&lt;span title=\&quot;$year\&quot; class=\&quot;yearClass\&quot; data-toggle=\&quot;tooltip\&quot;&gt; &quot; .substr($nr_tr_number, 0, 2).  &quot;&lt;/span&gt;&quot;;&#10;    $codehist .= &quot;&lt;span title=\&quot;$locationcode\&quot; class=\&quot;locationClass\&quot; data-toggle=\&quot;tooltip\&quot; &gt;&quot; .substr($nr_tr_number, 2, 2).  &quot;&lt;/span&gt;&quot;;&#10;    $codehist .= &quot;&lt;span title=\&quot;$sequence\&quot;  class=\&quot;sequenceClass\&quot; data-toggle=\&quot;tooltip\&quot; &gt;&quot; .substr($nr_tr_number, 4, 5).  &quot;&lt;/span&gt;&quot;;&#10;&#10;    echo($codehist);&#10;} else {&#10;    echo('NEW');&#10;};   ?&gt;';&#10;&#10;vtoolbar.items.push({type: 'html', id: 'itemTitle', html: '&lt;div class=&quot;toolbarTitle&quot;&gt;' + vCodeShow + '&lt;/div&gt;'});&#10;$('#trToolbar').w2toolbar(vtoolbar);&#10;&#10;&#10;// init the step controller&#10;thisObj.stepControl = $('#stepsArea').cgbApproveControl({&#10;    funcAction: this.updateStatus,&#10;    stepGridName: 'stepsGrid',&#10;    startNew: (thisObj.action == 'I'),&#10;    fkColumn: 'cd_test_request',&#10;    master: false,&#10;    stepType: 'TR',&#10;    code: thisObj.Form.getPk()&#10;});&#10;&#10;function onGridToolbarPressed(bPressed, dData) {&#10;    dsMainObject.ToolBarClick(bPressed, dData);&#10;}" description="Javascript - set Form/Grid/Toolbar" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-setTabs" value="$('#tab_browse_div').append($('#container-tr-browse').detach());&#10;&lt;?php echo($javascript); ?&gt;&#10;&#10;$('#mainTabsDiv').ctabStart({&#10;    afterChanged: thisObj.tabAfterChanged,&#10;    beforeChange: thisObj.tabBeforeChanged&#10;});&#10;//-----------------------------------------------------------------------&#10;//this.addListeners();&#10;&#10;this.tabBeforeChanged = function (id) {&#10;    if ((id == 'tab_detail') || (id == 'tab_sample')) {&#10;&#10;        var curTab = $('#mainTabsDiv').ctabGetSelected();&#10;        if(curTab == 'tab_browse') {&#10;            if (w2ui[thisObj.gridName].getSelection().length == 0) {&#10;                return false;&#10;            }&#10;        } else if(curTab == 'tab_my') {&#10;            if (w2ui['gridMyTR'].getSelection().length == 0) {&#10;                return false;&#10;            }&#10;        }&#10;    }&#10;    // it is important&#10;    return true;&#10;}&#10;&#10;this.tabAfterChanged = function (id, oldid) {&#10;    // cleanup&#10;    if (oldid == 'tab_sample') {&#10;        if (typeof dsSMPSheetObject != 'undefined') {&#10;            dsSMPSheetObject.close();&#10;            dsSMPSheetObject = undefined;&#10;            $('#tab_sample_div').empty();&#10;        }&#10;    }&#10;&#10;    if (id == 'tab_detail') {&#10;        var rrec = w2ui[thisObj.gridName].getSelection()[0];&#10;        thisObj.loadDetails(rrec);&#10;    }&#10;&#10;    if (id == 'tab_my') {&#10;        // dsMyTRObject has been loaded. change the label&#10;        if(w2ui['gridMyTR'] != undefined) {&#10;            var rrec = w2ui['gridMyTR'].getSelection();&#10;            if (rrec.length &gt; 0) {&#10;                var vdata = w2ui['gridMyTR'].getItem(rrec[0], 'nr_tr_number')&#10;                thisObj.setTabLabel(vdata);&#10;            } else {&#10;                thisObj.setTabLabel('');&#10;            }&#10;        }&#10;&#10;        thisObj.loadMyTR();&#10;    }&#10;    setGrpGridHeight();&#10;}" description="Javascript - set Tabs (click event)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-loadDetail" value="$('#tab_browse_div').append($('#container-tr-browse').detach());&#10;&lt;?php echo($javascript); ?&gt;&#10;&#10;$('#mainTabsDiv').ctabStart({&#10;    afterChanged: thisObj.tabAfterChanged,&#10;    beforeChange: thisObj.tabBeforeChanged&#10;});&#10;//-----------------------------------------------------------------------&#10;//this.addListeners();&#10;&#10;this.tabBeforeChanged = function (id) {&#10;    if ((id == 'tab_detail') || (id == 'tab_sample')) {&#10;&#10;        var curTab = $('#mainTabsDiv').ctabGetSelected();&#10;        if(curTab == 'tab_browse') {&#10;            if (w2ui[thisObj.gridName].getSelection().length == 0) {&#10;                return false;&#10;            }&#10;        } else if(curTab == 'tab_my') {&#10;            if (w2ui['gridMyTR'].getSelection().length == 0) {&#10;                return false;&#10;            }&#10;        }&#10;    }&#10;    // it is important&#10;    return true;&#10;}&#10;&#10;this.tabAfterChanged = function (id, oldid) {&#10;    // cleanup&#10;    if (oldid == 'tab_sample') {&#10;        if (typeof dsSMPSheetObject != 'undefined') {&#10;            dsSMPSheetObject.close();&#10;            dsSMPSheetObject = undefined;&#10;            $('#tab_sample_div').empty();&#10;        }&#10;    }&#10;&#10;    if (id == 'tab_detail') {&#10;        var rrec = w2ui[thisObj.gridName].getSelection()[0];&#10;        thisObj.loadDetails(rrec);&#10;    }&#10;&#10;    if (id == 'tab_my') {&#10;        // dsMyTRObject has been loaded. change the label&#10;        if(w2ui['gridMyTR'] != undefined) {&#10;            var rrec = w2ui['gridMyTR'].getSelection();&#10;            if (rrec.length &gt; 0) {&#10;                var vdata = w2ui['gridMyTR'].getItem(rrec[0], 'nr_tr_number')&#10;                thisObj.setTabLabel(vdata);&#10;            } else {&#10;                thisObj.setTabLabel('');&#10;            }&#10;        }&#10;&#10;        thisObj.loadMyTR();&#10;    }&#10;    setGrpGridHeight();&#10;}" description="Javascript - load detail page" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-grid-help" value="var recid = w2ui[thisObj.gridName].getPk();&#10;if (w2ui[thisObj.gridName].isNewRow(vcode)) {}" description="Javascript - Grid - Help: list some functions" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-toolbar" value="this.ToolBarClick = function(bPressed, bInfo) {&#10;    if (bPressed == 'insert') {&#10;        w2ui[thisObj.gridName].insertRow({&#10;            funcAfter: function (e) {&#10;            }&#10;        });&#10;    }&#10;    &#10;    if (bPressed == &quot;edit&quot;) {&#10;        var sel = w2ui[thisObj.gridName].getSelection();&#10;        if (sel.length == 0) {&#10;            messageBoxError('&lt;?php echo($errorNotSel) ?&gt;');&#10;            return;&#10;        }&#10;        thisObj.openEdit(sel[0], dData);&#10;    }&#10;    &#10;    if (bPressed == 'retrieve') {&#10;        w2ui[thisObj.gridName].retrieve();&#10;    }&#10;    &#10;    if (bPressed == &quot;update&quot;) {&#10;        w2ui['gridDocRepData'].update({updFunc: 'updateGridGeneral/' + thisObj.docid + '/' + thisObj.cd_pk});&#10;        setTimeout(function () {&#10;            if (typeof dsWOMainObject != 'undefined') {&#10;                dsWOMainObject.retrWO(1);&#10;                dsWOMainObject.retrWO(2);&#10;            }&#10;        }, 0);&#10;    }&#10;    &#10;    if (bPressed == &quot;delete&quot;) {&#10;        w2ui[thisObj.gridName].deleteRow({&#10;            funcAfter: function () {&#10;                thisObj.makeEvent()&#10;            }&#10;        });&#10;    }&#10;}&#10;&#10;makeFilterWithEnter(function () {&#10;    dsMainObject.ToolBarClick('retrieve');&#10;});&#10;&#10;function onGridToolbarPressed(bPressed, dData) {&#10;    dsMainObject.ToolBarClick(bPressed, dData);&#10;}" description="Javascript - Set Toolbar" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-grid-search" value="w2ui[thisObj.gridName].on('search', function(event) {&#10;    $('#container-tr-browse .btn-group button').removeClass('active');&#10;    $('#container-tr-browse .btn-group button:first').addClass('active');&#10;});" description="Javascript - Grid - search event" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-grid-dblclick" value="w2ui[thisObj.gridName].on('dblClick', function (event) {&#10;    var col = event.column;&#10;    var colname = w2ui['gridShippingCost'].columns[col].field;&#10;    var vid = chkUndefined(w2ui['gridShippingCost'].getItem(event.recid, 'cd_currency_rate'), -1);&#10;&#10;    if (colname == 'nr_currency_rate') {&#10;        event.preventDefault();&#10;        // do something&#10;    }&#10;&#10;    // default&#10;    $('#tab_detail a').click();&#10;});" description="Javascript - Grid - double click event" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-grid-rowFocusChanging" value="w2ui[thisObj.gridName].on('rowFocusChanging', function (event) {&#10;        if (event.recid_new &lt;= 0) return;&#10;        thisObj.selectSample = event.recid_new;&#10;        var vdata = chkUndefined(w2ui[thisObj.gridName].getItem(event.recid_new, 'ds_serial_number'), '');&#10;        thisObj.setTabLabel($('#fortab2 button[name=&quot;samdetail&quot;]'), thisObj.smpDetailText, vdata);&#10;    }&#10;);" description="Javascript - Grid -  row focus change" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-grid-retrieveOnAdd" value="w2ui[thisObj.gridName].on ('retrieveOnAdd', function(e){&#10;    e.onComplete = function(){&#10;        &lt;?php if ($openDetail == 'Y') { ?&gt;&#10;        setTimeout(function () {&#10;            $('#tab_detail a').click();&#10;        }, 0);&#10;        w2ui[thisObj.gridName].off('retrieveOnAdd');&#10;        &lt;?php } ?&gt;&#10;&#10;        thisObj.setFilterTab(e.data.resultset, '#container-tr-browse', 'ds_test_request_status');&#10;    }&#10;});" description="Javascript - Grid -  retrieveOnAdd" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-close" value="this.beforeClose = function () {&#10;    return w2ui[thisObj.gridName].getChanges().length == 0;&#10;}&#10;&#10;this.close = function (async) {&#10;    w2ui[thisObj.gridName].destroy();&#10;    &#10;    thisObj.Form.destroy(async);&#10;    &#10;    $(window).off('updateDocRep');&#10;&#10;    if (typeof dsFormObject != 'undefined') {&#10;        dsFormObject.close();&#10;        dsFormObject = undefined;&#10;&#10;        $('#tab_detail_div').empty();&#10;    }&#10;&#10;    introRemove();&#10;    return true;&#10;}" description="Javascript - close object &amp; form" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-resize" value="function setGrpGridHeight() {&#10;    var hAvail = getWorkArea();&#10;    // $(&quot;#tab_browse_div&quot;).css(&quot;height&quot;, hAvail - 40);&#10;    $(&quot;#browse_grid_div&quot;).css(&quot;height&quot;, hAvail - 75); // has a &quot;button group&quot;, so need minus more pixels.&#10;&#10;    w2ui[gridName].resize();&#10;&#10;    // call other object's resize.&#10;    if (typeof dsFormObject != 'undefined') {&#10;        dsFormObject.resize();&#10;    }&#10;}&#10;&#10;// funcao chamada quando o filtro some. tem que existir se existir filtro!&#10;function onFilterHidden() {&#10;    setGrpGridHeight();&#10;}&#10;&#10;$(window).on('resize.mainResize', function () {&#10;    setGrpGridHeight();&#10;});&#10;$(&quot;body&quot;).on('togglePushMenu toggleFilter', function () {&#10;    setGrpGridHeight();&#10;});&#10;&#10;setGrpGridHeight();" description="Javascript - resize height to fit height" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-duplicate" value="if (bPressed == 'duplicate') {&#10;    var vPK = w2ui[thisObj.gridName].getPk();&#10;    if (vPK == -1) {&#10;        return;&#10;    }&#10;&#10;    var vtr = w2ui[thisObj.gridName].getItem(vPK, 'nr_tr_number');&#10;&#10;    messageBoxYesNo(&quot;&lt;?php echo($duplicateTR)?&gt; &quot; + vtr , function(){&#10;        thisObj.duplicateTR(vPK);&#10;    })&#10;}&#10;&#10;this.duplicateTR = function(vrecid) {&#10;    $.myCgbAjax({url: 'tr/test_request/duplicateTR/'+vrecid,&#10;        success: function (data) {&#10;            if (data.status != 'OK') {&#10;                messageBoxAlert(data.status);&#10;                return;&#10;            }&#10;&#10;            w2ui[thisObj.gridName].add(data.rs);&#10;            w2ui[thisObj.gridName].ScrollToRow(data.rs[0].recid, true);&#10;&#10;            // also update the &quot;my tr&quot;&#10;            w2ui['gridMyTR'] &amp;&amp; w2ui['gridMyTR'].add(data.rs);&#10;            w2ui['gridMyTR'] &amp;&amp; w2ui['gridMyTR'].ScrollToRow(data.rs[0].recid, true);&#10;        },&#10;        errorAfter: function () {&#10;&#10;        }&#10;    });&#10;}" description="Javascript - duplicate a row of Grid" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-makeButtonGroup" value="this.setFilterTab = function (data, target, field_name) {&#10;    data = chkUndefined(data, []);&#10;    target = chkUndefined(target, '');&#10;    field_name = chkUndefined(field_name, '');&#10;    var arrData = [];&#10;    data.map(function (val) {&#10;        if (arrData.indexOf(val[field_name]) &lt; 0) {&#10;            arrData.push(val[field_name])&#10;        }&#10;    });&#10;&#10;    var htmlButtons = '';&#10;    if (arrData.length &gt; 0) {&#10;        htmlButtons += '&lt;button type=&quot;button&quot; class=&quot;btn btn-default active&quot; name=&quot;all&quot;&gt;All&lt;/button&gt;';&#10;        arrData.forEach(function (val) {&#10;            var displayTitle = val.toLowerCase().replace(/^./, val[0].toUpperCase());&#10;            htmlButtons += '&lt;button type=&quot;button&quot; class=&quot;btn btn-default&quot; name=&quot;' + val + '&quot;&gt;' + displayTitle + '&lt;/button&gt;'&#10;        });&#10;        $(target).find(&quot;.btn-group&quot;).html(htmlButtons);&#10;    } else {&#10;        $(target).find(&quot;.btn-group&quot;).hide();&#10;    }&#10;};&#10;&#10;&#10;// button group: status&#10;$('#container-tr-browse .btn-group').on('click', function (e) {&#10;    var el = e.target.name;&#10;    $(this).find('.btn').removeClass(&quot;active&quot;);&#10;    $(e.target).addClass(&quot;active&quot;);&#10;&#10;    if (el == 'all') {&#10;        // avoid load again.&#10;        if (thisObj.allLoaded != true) {&#10;            w2ui[thisObj.gridName].retrieve()&#10;            thisObj.allLoaded = true;&#10;        }&#10;&#10;        w2ui[thisObj.gridName].searchReset();&#10;&#10;    } else {&#10;        // if not loaded, fetch data.&#10;        if (thisObj.allLoaded != true) {&#10;            w2ui[thisObj.gridName].retrieve()&#10;            thisObj.allLoaded = true;&#10;        }&#10;        w2ui[thisObj.gridName].searchData = [{&#10;            field: 'ds_test_request_status',&#10;            operator: el == 'SAVED AND REJECTED' ? 'in' : 'is',&#10;            value: el == 'SAVED AND REJECTED' ? ['SAVED', 'REJECTED'] : el,&#10;            // type: 'int',&#10;            type: 'text',&#10;        }];&#10;        w2ui[thisObj.gridName].localSearch(true);&#10;        w2ui[thisObj.gridName].refresh();&#10;    }&#10;    setGrpGridHeight();&#10;&#10;});&#10;&#10;// re-active the &quot;all&quot; button.&#10;w2ui[thisObj.gridName].on('search', function(event) {&#10;    $('#container-tr-browse .btn-group button').removeClass('active');&#10;    $('#container-tr-browse .btn-group button:first').addClass('active');&#10;});" description="Javascript - make button group (like quick filter)" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-v-tabs" value="&lt;div class=&quot;row&quot;&gt;&#10;    &lt;?php echo($tab); ?&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;div id=&quot;container-tr-browse&quot;&gt;&#10;    &lt;div style=&quot;padding: 5px 0;&quot;&gt;&#10;        &lt;div class=&quot;btn-group btn-group-sm&quot; role=&quot;group&quot; aria-label=&quot;...&quot;&gt;&#10;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div id=&quot;browse_grid_div&quot;&gt;&lt;/div&gt;&#10;&lt;/div&gt;" description="HTML - tabs layout" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-v-collapsed" value="&lt;div class=&quot;box box-info box-solid collapsed-box&quot;&#10;     id=&quot;areaTRRelatedModels&quot;&gt;&#10;    &lt;div class=&quot;box-header with-border&quot;&#10;         ondblclick=&quot;dsFormObject.openOnDBL(this);&quot;&gt;&#10;        &lt;h3 class=&quot;box-title&quot;&gt; &lt;?php echo($titleRelModel) ?&gt; &lt;/h3&gt;&#10;        &lt;div class=&quot;box-tools pull-right&quot;&gt;&#10;            &lt;span data-toggle=&quot;tooltip&quot;&#10;                  title=&quot;&quot;&#10;                  id='relatedModelsBadge'&#10;                  class=&quot;badge bg-yellow&quot;&#10;                  data-original-title=&quot;&quot;&gt;1&lt;/span&gt;&#10;            &lt;button type='button'&#10;                    class='btn btn-box-tool'&#10;                    data-widget=&quot;collapse&quot;&gt;&lt;i class='fa fa-expand'&gt;&lt;/i&gt;&lt;/button&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;    &lt;div class=&quot;box-body&quot;&gt;&#10;        &lt;div style=&quot;height: 150px; width: 100%&quot;&#10;             id=&quot;relatedModelsDiv&quot;&gt;&lt;/div&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;" description="HTML - collapsed box" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-v-full" value="&lt;div id=&quot;fullGridArea&quot;&#10;     class=&quot;divfullscreen&quot;&#10;     style=&quot;display: none; padding-top: 10px; padding-bottom:  10px; padding-left: 10px; padding-right: 10px;background-color: white&quot;&gt;&#10;    &lt;div id=&quot;fullGridAreaGrid&quot;&#10;         style=&quot;width: 100%; height: calc(100% - 40px)&quot;&gt;&lt;/div&gt;&#10;&lt;/div&gt;" description="HTML - full screen" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-f-getuser" value="$userInfo = $this-&gt;humanmodel-&gt;retRetrieveArray(&quot; WHERE cd_human_resource={$this-&gt;session-&gt;userdata('cd_human_resource')} and cd_location_default IS NOT NULL&quot;);&#10;$arrayLoc = array();&#10;foreach($userInfo as $key =&gt; $value) {&#10;    array_push($arrayLoc, array('recid' =&gt; $value['cd_location_default'], 'description' =&gt;$value['ds_location_default'] ));&#10;}" description="Function get user info()" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-f-getperm" value="$perm_edit = $this-&gt;getCdbhelper()-&gt;getUserPermission('fl_is_test_engineer') == 'Y';" description="Function - get User Permission()" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-form-multi" value="select2Start('ds_requesters_form', 'human_resource_controller/retPickListMail', '', 'cgbDestroyThis')&#10;var vRequesters = [];&#10;if (!$.isArray(thisObj.requesters)) {&#10;    thisObj.requesters = JSON.parse(thisObj.requesters);&#10;}&#10;&#10;$.each(thisObj.requesters, function (i, v) {&#10;    vRequesters.push({id: v.cd_human_resource, text: v.ds_human_resource});&#10;});&#10;&#10;select2Data('ds_requesters_form', vRequesters);" description="Javascript - Form - set multi choose element" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-form-pospicklist" value="$('#formShipping').on('pospicklist', function (ev) {&#10;&#10;    if (ev.fielddata.codefield == 'cd_department_cost_center') {&#10;        thisObj.setScreenPermissions();&#10;    }&#10;});" description="Javascript - Form - set picklist After choose" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-gird-itemChanging" value="w2ui['gridShippingCost'].on('itemChanging', function (a) {&#10;    a.onComplete = function() {&#10;        if (a.colname == 'nr_amount') {&#10;            // can input 0! (it doesn't make sense, but it does.)&#10;            // if (chkUndefined(w2ui['gridShippingCost'].getItem(a.recid, 'nr_amount'), 0) == 1) {&#10;            //     return;&#10;            // }&#10;&#10;            thisObj.calculateValues();&#10;        }&#10;    }&#10;});" description="Javascript - Grid - item is changing" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-basicPickListOpen" value="basicPickListOpen({controller: 'currency_rate/openPL/2/' + cd_currency,&#10;    title: 'Currency Rate',&#10;    sel_id: vid,&#10;    showTitle: true,&#10;    plCallBack: function (id, desc, rec) {&#10;        w2ui['gridShippingCost'].setItem(event.recid, 'cd_currency_rate', rec.cd_currency_rate);&#10;        w2ui['gridShippingCost'].setItem(event.recid, 'nr_currency_rate', rec.nr_currency_rate);&#10;&#10;        // thisObj.setToSameCurrency('gridShippingCost', event.recid);&#10;        thisObj.calculateValues();&#10;    }&#10;});" description="Javascript - open a popup window with controller" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-grid-setItem" value="w2ui[gridName].setItem(element.recid, 'ds_currency', ds_currency);" description="Javascript - Grid - setItem" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-grid-getItem" value="cd_currency = w2ui[gridName].getItem(recid, 'cd_currency');" description="Javascript - Grid - getItem" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-foreach" value="w2ui[gridName].records.forEach( function(element, index) {&#10;&#10;});" description="Javascript - foreach" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-chkUndefined" value="var curAmountUSD = chkUndefined(w2ui['gridShippingCost'].getItem(element.recid, 'nr_amount'), 0) / rate;" description="Javascript - check element /value is undefined" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-js-form-help" value="thisObj.Form.setDemanded('ds_project_form', isProjectRequired);" description="Javascript - Form - help: list functions" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="HTML" value="true" />
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP Expression" value="true" />
      <option name="PHP Statement" value="true" />
    </context>
  </template>
  <template name="t-js-form-setEnable" value="thisObj.Form.setEnabled('dt_completed_date_form', (vSequence !== ''));" description="Javascript - Form - set a field Enable" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="JAVA_SCRIPT" value="true" />
      <option name="PHP" value="true" />
    </context>
  </template>
  <template name="t-js-form-setDemaned" value="thisObj.Form.setDemanded('ds_project_form', isProjectRequired);" description="Javascript - Form - set a field is Required" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="ES6_STATEMENT" value="true" />
      <option name="JS_STATEMENT" value="true" />
    </context>
  </template>
  <template name="t-form-num" value="&lt;label for=&quot;nr_total_cost_form&quot; class=&quot;col-sm-1 control-label&quot;&gt;&lt;?php echo($formTrans_nr_total_cost) ?&gt;:&lt;/label&gt;&#10;&lt;div class=&quot;col-sm-2&quot;&gt;&#10;    &lt;input type=&quot;text&quot; &#10;        class=&quot;form-control input-sm&quot; &#10;        fieldname=&quot;nr_total_cost&quot;&#10;        id=&quot;nr_total_cost_form&quot; &#10;        mask=&quot;N;18.2&quot; &#10;        ro=&quot;Y&quot; &#10;        value=&quot;&lt;?php hecho($nr_total_cost); ?&gt;&quot;&gt;&#10;&lt;/div&gt;" description="Form - Float/Numeric" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="HTML_TEXT" value="true" />
    </context>
  </template>
  <template name="t-form-choose" value="&lt;div class=&quot;input-group&quot;&gt;&#10;    &lt;input type=&quot;text&quot; &#10;        class=&quot;form-control input-sm&quot; &#10;        value=&quot;&lt;?php hecho($ds_project) ?&gt;&quot; &#10;        fieldname=&quot;ds_project&quot; &#10;        id=&quot;ds_project_form&quot; &#10;        mask=&quot;c&quot; &#10;        maxlength=&quot;&quot;&gt;&#10;    &lt;span class=&quot;input-group-btn&quot;&gt; &#10;        &lt;button &#10;            class=&quot;btn input-sm btn-primary&quot; &#10;            id=&quot;btnSelectModel&quot; &#10;            type=&quot;button&quot; &#10;            onclick=&quot;dsShippingFormObject.openModelSelection();&quot;&gt;&#10;                &lt;i class=&quot;fa fa-search&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#10;        &lt;/button&gt;&#10;    &lt;/span&gt;&#10;&lt;/div&gt;&#10;&lt;!-- hidden cd_project_model --&gt;&#10;&lt;div class=&quot;hidden&quot;&gt;&#10;    &lt;input type=&quot;text&quot; class=&quot;form-control input-sm&quot; value=&quot;&lt;?php hecho($cd_project_model) ?&gt;&quot; fieldname=&quot;cd_project_model&quot; id=&quot;cd_project_model_form&quot; mask=&quot;I&quot;&gt;&#10;&lt;/div&gt;" description="Form - button+choose+input" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="HTML_TEXT" value="true" />
    </context>
  </template>
  <template name="t-form-str" value="&lt;input type=&quot;text&quot; &#10;    class=&quot;form-control input-sm&quot; &#10;    fieldname=&quot;ds_por&quot; &#10;    id=&quot;ds_por_form&quot;&#10;    mask=&quot;c&quot; &#10;    value=&quot;&lt;?php hecho($ds_por); ?&gt;&quot;&gt;" description="Form - string" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="HTML_TEXT" value="true" />
    </context>
  </template>
  <template name="t-form-int" value="&lt;input type=&quot;text&quot; &#10;                                class=&quot;form-control input-sm&quot; &#10;                                fieldname=&quot;nr_qty&quot; &#10;                                id=&quot;nr_qty_form&quot;&#10;                                mask=&quot;I&quot; &#10;                                ro=&quot;Y&quot; &#10;                                value=&quot;&lt;?php hecho($nr_qty); ?&gt;&quot;&gt;" description="Form - Integer" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="HTML_TEXT" value="true" />
    </context>
  </template>
  <template name="t-c-duplicate" value="public function duplicateTR($tr) {&#10;&#10;        $tr = $this-&gt;getCdbhelper()-&gt;normalizeDataToSQL('int', $tr);&#10;&#10;        $sql = &quot;select tr.trduplicate($tr) as newcode&quot;;&#10;&#10;        $ret = $this-&gt;getCdbhelper()-&gt;basicSQLArray($sql);&#10;        $code = $ret[0]['newcode'];&#10;&#10;        $data = $this-&gt;mainmodel-&gt;retRetrieveGridJson(&quot;WHERE cd_test_request = $code&quot;, &quot;&quot;);&#10;&#10;        $msg = '{&quot;status&quot;:&quot;OK&quot;, &quot;rs&quot;:' . $data . ' }';&#10;&#10;        echo($msg);&#10;    }" description="Duplicate a record (call postgresql porcedure)" toReformat="true" toShortenFQNames="true">
    <context>
      <option name="PHP Class Member" value="true" />
    </context>
  </template>
</templateSet>